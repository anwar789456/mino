<div class="flex gap-6 p-8">
  <!-- Main Content -->
  <div class="flex-1">
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-xl font-bold text-[#0f1724] tracking-wide uppercase font-['SN_Pro']">Current Learning Path</h1>
      </div>
      <div class="flex items-center gap-3">
        <!-- @if (isTutor) {
          <button (click)="openCreateCourse()" class="flex items-center gap-1.5 px-4 py-2 text-sm font-semibold text-white bg-[#38a9f3] rounded-lg hover:bg-[#2196e3] transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            Add Course
          </button>
        } -->
        <button class="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-400 hover:bg-gray-50">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Top Bar: Language, Streak, Coins -->
    <div class="flex items-center gap-6 mb-6 text-sm">
      <div class="flex items-center gap-1.5">
        <span class="text-red-400">ğŸ´</span>
        <span class="font-medium text-[#0f1724]">EN</span>
      </div>
      <div class="flex items-center gap-1.5">
        <span class="text-orange-400">ğŸ”¥</span>
        <span class="font-medium text-[#0f1724]">{{ user.streak }}</span>
      </div>
      <div class="flex items-center gap-1.5">
        <span class="text-[#38a9f3]">ğŸ’</span>
        <span class="font-medium text-[#0f1724]">{{ user.xp }}</span>
      </div>
    </div>

    <!-- Course Form Modal -->
    @if (showCourseForm) {
      <div class="bg-white border border-[#38a9f3] rounded-xl p-6 mb-6 shadow-lg">
        <h3 class="text-lg font-bold text-[#0f1724] font-['SN_Pro'] mb-4">{{ editingCourse ? 'Edit Course' : 'Create New Course' }}</h3>
        <form [formGroup]="courseForm" (ngSubmit)="saveCourse()" class="flex flex-col gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
            <input formControlName="title" type="text" placeholder="Course title" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-[#38a9f3]" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <textarea formControlName="description" rows="2" placeholder="Course description" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-[#38a9f3] resize-none"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Content</label>
            <textarea formControlName="content" rows="4" placeholder="Full course content" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-[#38a9f3] resize-none"></textarea>
          </div>
          <!-- <div class="flex items-center gap-3">
            <button type="submit" [disabled]="courseForm.invalid" class="px-5 py-2 text-sm font-semibold text-white bg-[#38a9f3] rounded-lg hover:bg-[#2196e3] transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              {{ editingCourse ? 'Update' : 'Create' }}
            </button>
            <button type="button" (click)="cancelCourseForm()" class="px-5 py-2 text-sm font-semibold text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
              Cancel
            </button>
          </div> -->
        </form>
      </div>
    }

    <!-- Contenu Form Modal -->
    @if (showContenuForm) {
      <div class="bg-white border border-[#56c416] rounded-xl p-6 mb-6 shadow-lg">
        <h3 class="text-lg font-bold text-[#0f1724] font-['SN_Pro'] mb-4">{{ editingContenu ? 'Edit Contenu' : 'Add Contenu' }}</h3>
        <form [formGroup]="contenuForm" (ngSubmit)="saveContenu()" class="flex flex-col gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
            <input formControlName="titleC" type="text" placeholder="Contenu title" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-[#56c416]" />
          </div>
          <div class="flex gap-4">
            <div class="flex-1">
              <label class="block text-sm font-medium text-gray-700 mb-1">Duration (minutes)</label>
              <input formControlName="duration" type="number" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-[#56c416]" />
            </div>
            <div class="flex-1">
              <label class="block text-sm font-medium text-gray-700 mb-1">Content Type</label>
              <select formControlName="contentType" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-[#56c416]">
                <option value="VIDEO">VIDEO</option>
                <option value="PDF">PDF</option>
                <option value="TEXT">TEXT</option>
              </select>
            </div>
          </div>
          <!-- <div class="flex items-center gap-3">
            <button type="submit" [disabled]="contenuForm.invalid" class="px-5 py-2 text-sm font-semibold text-white bg-[#56c416] rounded-lg hover:bg-[#45a310] transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              {{ editingContenu ? 'Update' : 'Add' }}
            </button>
            <button type="button" (click)="cancelContenuForm()" class="px-5 py-2 text-sm font-semibold text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
              Cancel
            </button>
          </div> -->
        </form>
      </div>
    }

    <!-- Loading State -->
    @if (isLoading) {
      <div class="flex flex-col items-center justify-center py-16">
        <div class="w-10 h-10 border-4 border-[#38a9f3] border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-gray-500 text-sm">Loading courses...</p>
      </div>
    }

    <!-- Error State -->
    @if (errorMessage) {
      <div class="bg-red-50 border border-red-200 rounded-xl p-5 mb-6 text-center">
        <p class="text-red-600 text-sm font-medium">{{ errorMessage }}</p>
      </div>
    }

    <!-- Empty State -->
    @if (!isLoading && !errorMessage && courses.length === 0) {
      <div class="bg-gray-50 border border-gray-200 rounded-xl p-10 text-center">
        <div class="text-4xl mb-3">ğŸ“š</div>
        <h3 class="text-base font-bold text-[#0f1724] font-['SN_Pro'] mb-1">No courses available</h3>
        <p class="text-sm text-gray-500">Courses will appear here once they are created.</p>
      </div>
    }

    <!-- Courses List -->
    @if (!isLoading && courses.length > 0) {
      <h2 class="text-base font-bold text-[#0f1724] mb-4 font-['SN_Pro']">Your Courses</h2>
      @for (course of courses; track course.id; let i = $index) {
        <div class="border border-gray-200 rounded-xl mb-4 bg-white hover:border-[#38a9f3] hover:shadow-sm transition-all">
          <div class="p-5 flex items-center gap-5 cursor-pointer group" (click)="toggleCourseDetail(course.id!)">
            <!-- Course Number Badge -->
            <div class="w-14 h-14 rounded-xl flex items-center justify-center shrink-0 text-white font-bold text-lg"
                 [style.background]="'linear-gradient(135deg, ' + (['#38a9f3','#56c416','#f59e0b','#8b5cf6','#ec4899','#14b8a6'])[i % 6] + ', ' + (['#2196e3','#45a310','#e08e00','#7c3aed','#db2777','#0d9488'])[i % 6] + ')'">
              {{ i + 1 }}
            </div>

            <!-- Course Info -->
            <div class="flex-1 min-w-0">
              <h3 class="text-base font-bold text-[#0f1724] font-['SN_Pro'] group-hover:text-[#38a9f3] transition-colors">{{ course.title }}</h3>
              <p class="text-sm text-gray-500 mt-0.5 line-clamp-1">{{ course.description }}</p>
              <div class="flex items-center gap-3 mt-2">
                <span class="inline-flex items-center gap-1 text-xs text-gray-400">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.331 0 4.467.89 6.064 2.346M12 6.042c1.597 1.456 3.733 2.346 6.064 2.346 1.052 0 2.062-.18 3-.512v14.25A8.987 8.987 0 0018 18c-2.331 0-4.467.89-6.064 2.346" />
                  </svg>
                  {{ getContentCount(course) }} lessons
                </span>
              </div>
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-2 shrink-0">
              @if (isTutor) {
                <button (click)="openEditCourse(course); $event.stopPropagation()" class="p-2 text-gray-400 hover:text-[#38a9f3] transition-colors rounded-lg hover:bg-blue-50" title="Edit course">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z" />
                  </svg>
                </button>
                <button (click)="deleteCourse(course); $event.stopPropagation()" class="p-2 text-gray-400 hover:text-red-500 transition-colors rounded-lg hover:bg-red-50" title="Delete course">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                  </svg>
                </button>
              }
              <button class="bg-[#38a9f3] text-white px-6 py-2.5 rounded-lg font-semibold text-sm hover:bg-[#2196e3] transition-colors opacity-0 group-hover:opacity-100">
                VIEW
              </button>
            </div>
          </div>

          <!-- Expanded Course Detail with Contenus -->
          @if (expandedCourseId === course.id) {
            <div class="border-t border-gray-100 px-5 pb-5">
              <div class="pt-4 mb-3">
                <p class="text-sm text-gray-600 leading-relaxed">{{ course.content }}</p>
              </div>

              <!-- Contenus List -->
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-sm font-bold text-[#0f1724]">Contenus ({{ course.contenus?.length || 0 }})</h4>
                @if (isTutor) {
                  <button (click)="openAddContenu(course.id!)" class="flex items-center gap-1 text-xs font-semibold text-[#56c416] hover:text-[#45a310] transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Add Contenu
                  </button>
                }
              </div>

              @if (course.contenus && course.contenus.length > 0) {
                @for (contenu of course.contenus; track contenu.idContent) {
                  <div class="flex items-center gap-3 py-2.5 border-t border-gray-50">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold shrink-0"
                         [class.bg-blue-50]="contenu.contentType === 'VIDEO'" [class.text-blue-500]="contenu.contentType === 'VIDEO'"
                         [class.bg-red-50]="contenu.contentType === 'PDF'" [class.text-red-500]="contenu.contentType === 'PDF'"
                         [class.bg-green-50]="contenu.contentType === 'TEXT'" [class.text-green-500]="contenu.contentType === 'TEXT'">
                      {{ contenu.contentType === 'VIDEO' ? 'â–¶' : contenu.contentType === 'PDF' ? 'ğŸ“„' : 'ğŸ“' }}
                    </div>
                    <div class="flex-1 min-w-0">
                      <p class="text-sm font-medium text-[#0f1724]">{{ contenu.titleC }}</p>
                      <p class="text-xs text-gray-400">{{ contenu.duration }} min Â· {{ contenu.contentType }}</p>
                    </div>
                    @if (isTutor) {
                      <button (click)="openEditContenu(contenu, course.id!)" class="p-1.5 text-gray-400 hover:text-[#38a9f3] transition-colors rounded" title="Edit contenu">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z" />
                        </svg>
                      </button>
                      <button (click)="deleteContenu(contenu)" class="p-1.5 text-gray-400 hover:text-red-500 transition-colors rounded" title="Delete contenu">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                      </button>
                    }
                  </div>
                }
              } @else {
                <p class="text-xs text-gray-400 py-2">No contenus yet.</p>
              }
            </div>
          }
        </div>
      }
    }
  </div>

  <!-- Right Sidebar -->
  <div class="w-72 shrink-0 flex flex-col gap-4">
    <!-- Daily Goal -->
    <div class="bg-white border border-gray-200 rounded-xl p-5">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-base font-bold text-[#0f1724] font-['SN_Pro']">Daily Goal</h3>
        <span class="text-[#38a9f3] text-sm font-semibold cursor-pointer">EDIT</span>
      </div>
      <div class="flex justify-center mb-3">
        <div class="relative w-24 h-24">
          <svg class="w-24 h-24 transform -rotate-90" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="none" />
            <circle cx="50" cy="50" r="40" stroke="#f59e0b" stroke-width="8" fill="none"
              stroke-dasharray="251.2" stroke-dashoffset="62.8" stroke-linecap="round" />
          </svg>
          <div class="absolute inset-0 flex items-center justify-center">
            <span class="text-2xl font-bold text-[#f59e0b]">24</span>
            <span class="text-xs text-[#f59e0b] ml-0.5 mt-1">XP</span>
          </div>
        </div>
      </div>
      <p class="text-center text-sm text-gray-500">You're <span class="text-[#f59e0b] font-semibold">26 XP</span> away from your daily goal!</p>
    </div>

    <!-- Leaderboard -->
    <div class="bg-white border border-gray-200 rounded-xl p-5">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-base font-bold text-[#0f1724] font-['SN_Pro']">Leaderboard</h3>
        <span class="text-[#38a9f3] text-sm font-semibold cursor-pointer">VIEW ALL</span>
      </div>
      @for (entry of leaderboard; track entry.rank) {
        <div class="flex items-center gap-3 py-2" [class.bg-yellow-50]="entry.isCurrentUser" [class.rounded-lg]="entry.isCurrentUser" [class.px-2]="entry.isCurrentUser">
          <span class="text-sm font-bold w-5" [class.text-[#38a9f3]]="entry.rank <= 2" [class.text-[#56c416]]="entry.isCurrentUser">{{ entry.rank }}</span>
          <div class="w-8 h-8 rounded-full overflow-hidden bg-gray-200 shrink-0">
            <img [src]="entry.avatar" [alt]="entry.name" class="w-full h-full object-cover" />
          </div>
          <span class="flex-1 text-sm font-medium text-[#0f1724]">{{ entry.name }}</span>
          <span class="text-sm text-gray-500">{{ entry.xp }} XP</span>
        </div>
      }
    </div>

    <!-- Course Stats -->
    <div class="bg-white border border-gray-200 rounded-xl p-5">
      <h3 class="text-base font-bold text-[#0f1724] font-['SN_Pro'] mb-2">Course Stats</h3>
      <p class="text-sm text-gray-500 mb-3">You have <span class="text-[#38a9f3] font-semibold">{{ courses.length }}</span> courses available.</p>
      <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
        <div class="h-full bg-[#56c416] rounded-full transition-all" [style.width.%]="courses.length > 0 ? 20 : 0"></div>
      </div>
    </div>
  </div>
</div>
