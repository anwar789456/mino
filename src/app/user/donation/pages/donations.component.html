<div class="p-8 w-full max-w-4xl mx-auto">
  <!-- Header -->
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-2xl font-extrabold text-[#0f1724]">My Donations</h1>
      <p class="text-sm text-[#536471] mt-1">Track and manage your donation history.</p>
    </div>
    <button
      (click)="openDonateModal()"
      class="flex items-center gap-2 bg-[#38a9f3] text-white text-sm font-semibold px-5 py-2.5 rounded-xl hover:bg-[#2196e3] transition-colors shadow-sm"
    >
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
      Donate
    </button>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-3 gap-4 mb-8">
    <div class="bg-white border border-gray-200 rounded-2xl p-5 text-center">
      <div class="w-10 h-10 bg-[#f0f9ff] rounded-full flex items-center justify-center mx-auto mb-2">
        <svg class="w-5 h-5 text-[#38a9f3]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      </div>
      <p class="text-2xl font-bold text-[#38a9f3]">${{ totalDonated }}</p>
      <p class="text-xs text-[#94a3b8] mt-1">Total Donated</p>
    </div>
    <div class="bg-white border border-gray-200 rounded-2xl p-5 text-center">
      <div class="w-10 h-10 bg-[#f0fdf4] rounded-full flex items-center justify-center mx-auto mb-2">
        <svg class="w-5 h-5 text-[#56c416]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      </div>
      <p class="text-2xl font-bold text-[#56c416]">{{ successCount }}</p>
      <p class="text-xs text-[#94a3b8] mt-1">Successful</p>
    </div>
    <div class="bg-white border border-gray-200 rounded-2xl p-5 text-center">
      <div class="w-10 h-10 bg-[#fef3c7] rounded-full flex items-center justify-center mx-auto mb-2">
        <svg class="w-5 h-5 text-[#f59e0b]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      </div>
      <p class="text-2xl font-bold text-[#f59e0b]">{{ pendingCount }}</p>
      <p class="text-xs text-[#94a3b8] mt-1">Pending</p>
    </div>
  </div>

  <!-- Filter Tabs -->
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-extrabold text-[#0f1724]">Donation History</h2>
    <div class="flex items-center gap-2">
      @for (tab of tabs; track tab) {
        <button
          class="px-4 py-1.5 rounded-full text-sm font-medium border transition-colors"
          [class.bg-[#0f1724]]="activeTab === tab"
          [class.text-white]="activeTab === tab"
          [class.border-[#0f1724]]="activeTab === tab"
          [class.bg-white]="activeTab !== tab"
          [class.text-[#536471]]="activeTab !== tab"
          [class.border-gray-200]="activeTab !== tab"
          [class.hover:bg-gray-50]="activeTab !== tab"
          (click)="activeTab = tab"
        >
          {{ tab }}
        </button>
      }
    </div>
  </div>

  <!-- Donation List -->
  <div class="flex flex-col gap-3">
    @if (loading) {
      <div class="bg-white border border-gray-200 rounded-2xl p-10 text-center">
        <svg class="w-8 h-8 text-[#38a9f3] mx-auto mb-3 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>
        <p class="text-sm text-[#94a3b8]">Loading donations...</p>
      </div>
    }
    @for (donation of filteredDonations; track donation.id ?? donation.donatedAt) {
      <div class="bg-white border border-gray-200 rounded-2xl p-5 flex items-center justify-between">
        <div class="flex items-center gap-4">
          <!-- Status Icon -->
          <div
            class="w-10 h-10 rounded-full flex items-center justify-center shrink-0"
            [class.bg-[#f0fdf4]]="donation.status === 'SUCCESS'"
            [class.bg-[#fef3c7]]="donation.status === 'PENDING'"
            [class.bg-[#fef2f2]]="donation.status === 'FAILED'"
          >
            @if (donation.status === 'SUCCESS') {
              <svg class="w-5 h-5 text-[#56c416]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>
            } @else if (donation.status === 'PENDING') {
              <svg class="w-5 h-5 text-[#f59e0b]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            } @else {
              <svg class="w-5 h-5 text-[#ef4444]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            }
          </div>
          <!-- Details -->
          <div>
            <div class="flex items-center gap-2">
              <p class="text-sm font-semibold text-[#0f1724]">{{ donation.message || 'No message' }}</p>
              @if (donation.anonymous) {
                <span class="text-[10px] font-medium bg-[#f1f5f9] text-[#64748b] px-2 py-0.5 rounded-full">Anonymous</span>
              }
            </div>
            <div class="flex items-center gap-3 mt-1 text-xs text-[#94a3b8]">
              @if (donation.donatedAt) {
                <span>{{ donation.donatedAt }}</span>
              }
              <span class="flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" /></svg>
                {{ donation.paymentMethod }}
              </span>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <div class="text-right">
            <p class="text-base font-bold text-[#0f1724]">${{ donation.amount.toFixed(2) }}</p>
            <span
              class="text-[11px] font-medium px-2 py-0.5 rounded-full"
              [class.bg-[#f0fdf4]]="donation.status === 'SUCCESS'"
              [class.text-[#56c416]]="donation.status === 'SUCCESS'"
              [class.bg-[#fef3c7]]="donation.status === 'PENDING'"
              [class.text-[#f59e0b]]="donation.status === 'PENDING'"
              [class.bg-[#fef2f2]]="donation.status === 'FAILED'"
              [class.text-[#ef4444]]="donation.status === 'FAILED'"
            >
              {{ donation.status }}
            </span>
          </div>
          <button
            (click)="openEditModal(donation)"
            class="w-8 h-8 flex items-center justify-center rounded-lg border border-gray-200 text-[#536471] hover:bg-[#f0f9ff] hover:text-[#38a9f3] hover:border-[#38a9f3] transition-colors"
            title="Modify"
          >
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>
          </button>
          <button
            (click)="confirmDelete(donation)"
            class="w-8 h-8 flex items-center justify-center rounded-lg border border-gray-200 text-[#536471] hover:bg-[#fef2f2] hover:text-[#ef4444] hover:border-[#ef4444] transition-colors"
            title="Delete"
          >
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg>
          </button>
        </div>
      </div>
    }

    @if (!loading && filteredDonations.length === 0) {
      <div class="bg-white border border-gray-200 rounded-2xl p-10 text-center">
        <svg class="w-12 h-12 text-[#d1d5db] mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 109.375 7.5H12m0-2.625V7.5m0-2.625A2.625 2.625 0 1114.625 7.5H12m0 0V21m-8.625-9.75h18c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125h-18c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" /></svg>
        <p class="text-sm font-semibold text-[#0f1724]">No donations found</p>
        <p class="text-xs text-[#94a3b8] mt-1">Your donations will appear here.</p>
      </div>
    }
  </div>
</div>

<!-- Donate Modal Overlay -->
@if (showModal) {
  <div class="fixed inset-0 z-50 flex items-center justify-center">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" (click)="closeDonateModal()"></div>

    <!-- Modal -->
    <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-in">
      <!-- Modal Header -->
      <div class="bg-gradient-to-r from-[#38a9f3] to-[#2196e3] p-6 pb-8">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-extrabold text-white">{{ editingDonationId ? 'Edit Donation' : 'Make a Donation' }}</h2>
          <button (click)="closeDonateModal()" class="text-white/70 hover:text-white transition-colors">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
          </button>
        </div>
        <p class="text-sm text-white/80">{{ editingDonationId ? 'Update your donation details.' : 'Your generosity makes a difference.' }}</p>
      </div>

      <!-- Form -->
      <form (ngSubmit)="submitDonation()" class="p-6 -mt-4">
        <!-- Amount -->
        <div class="bg-white border border-gray-200 rounded-xl p-4 mb-4 shadow-sm">
          <label class="block text-xs font-semibold text-[#94a3b8] uppercase tracking-wide mb-2">Amount ($)</label>
          <div class="flex items-center gap-2">
            <span class="text-2xl font-bold text-[#0f1724]">$</span>
            <input
              type="number"
              [(ngModel)]="formData.amount"
              name="amount"
              placeholder="0.00"
              min="0.01"
              step="0.01"
              required
              class="w-full text-2xl font-bold text-[#0f1724] outline-none placeholder:text-[#d1d5db] [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
            />
          </div>
        </div>

        <!-- Quick Amounts -->
        <div class="flex gap-2 mb-4">
          @for (amt of [5, 10, 25, 50, 100]; track amt) {
            <button
              type="button"
              (click)="formData.amount = amt"
              class="flex-1 py-2 text-sm font-semibold rounded-lg border transition-colors"
              [class.bg-[#38a9f3]]="formData.amount === amt"
              [class.text-white]="formData.amount === amt"
              [class.border-[#38a9f3]]="formData.amount === amt"
              [class.bg-white]="formData.amount !== amt"
              [class.text-[#536471]]="formData.amount !== amt"
              [class.border-gray-200]="formData.amount !== amt"
              [class.hover:bg-gray-50]="formData.amount !== amt"
            >
              ${{ amt }}
            </button>
          }
        </div>

        <!-- Message -->
        <div class="mb-4">
          <label class="block text-xs font-semibold text-[#94a3b8] uppercase tracking-wide mb-2">Message (optional)</label>
          <textarea
            [(ngModel)]="formData.message"
            name="message"
            rows="2"
            placeholder="Add a note to your donation..."
            class="w-full border border-gray-200 rounded-xl px-4 py-3 text-sm text-[#0f1724] outline-none focus:border-[#38a9f3] transition-colors resize-none placeholder:text-[#d1d5db]"
          ></textarea>
        </div>

        <!-- Payment Method -->
        <div class="mb-4">
          <label class="block text-xs font-semibold text-[#94a3b8] uppercase tracking-wide mb-2">Payment Method</label>
          <div class="flex gap-2">
            @for (method of paymentMethods; track method) {
              <button
                type="button"
                (click)="formData.paymentMethod = method"
                class="flex-1 py-2.5 text-sm font-medium rounded-xl border transition-colors"
                [class.bg-[#0f1724]]="formData.paymentMethod === method"
                [class.text-white]="formData.paymentMethod === method"
                [class.border-[#0f1724]]="formData.paymentMethod === method"
                [class.bg-white]="formData.paymentMethod !== method"
                [class.text-[#536471]]="formData.paymentMethod !== method"
                [class.border-gray-200]="formData.paymentMethod !== method"
                [class.hover:bg-gray-50]="formData.paymentMethod !== method"
              >
                {{ method }}
              </button>
            }
          </div>
        </div>

        <!-- Anonymous Toggle -->
        <div class="flex items-center justify-between mb-6 bg-[#f8fafc] rounded-xl px-4 py-3">
          <div>
            <p class="text-sm font-semibold text-[#0f1724]">Donate anonymously</p>
            <p class="text-xs text-[#94a3b8]">Your name won't be shown publicly</p>
          </div>
          <button
            type="button"
            (click)="formData.anonymous = !formData.anonymous"
            class="relative w-11 h-6 rounded-full transition-colors"
            [class.bg-[#38a9f3]]="formData.anonymous"
            [class.bg-[#d1d5db]]="!formData.anonymous"
          >
            <span
              class="absolute top-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform"
              [class.left-0.5]="!formData.anonymous"
              [class.left-[22px]]="formData.anonymous"
            ></span>
          </button>
        </div>

        <!-- Submit -->
        <button
          type="submit"
          [disabled]="submitting || !formData.amount || formData.amount <= 0"
          class="w-full py-3 rounded-xl text-sm font-bold transition-colors"
          [class.bg-[#38a9f3]]="!submitting && formData.amount && formData.amount > 0"
          [class.hover:bg-[#2196e3]]="!submitting && formData.amount && formData.amount > 0"
          [class.text-white]="!submitting && formData.amount && formData.amount > 0"
          [class.bg-gray-200]="submitting || !formData.amount || formData.amount! <= 0"
          [class.text-gray-400]="submitting || !formData.amount || formData.amount! <= 0"
          [class.cursor-not-allowed]="submitting || !formData.amount || formData.amount! <= 0"
        >
          @if (submitting) {
            {{ editingDonationId ? 'Updating...' : 'Sending...' }}
          } @else if (editingDonationId) {
            Update Donation
          } @else {
            Donate {{ formData.amount ? '$' + formData.amount : '' }}
          }
        </button>
      </form>
    </div>
  </div>
}

<!-- Delete Confirmation Modal -->
@if (showDeleteConfirm) {
  <div class="fixed inset-0 z-50 flex items-center justify-center">
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" (click)="cancelDelete()"></div>
    <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-sm mx-4 p-6 text-center">
      <div class="w-14 h-14 bg-[#fef2f2] rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-7 h-7 text-[#ef4444]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
      </div>
      <h3 class="text-lg font-bold text-[#0f1724] mb-2">Delete Donation</h3>
      <p class="text-sm text-[#536471] mb-6">Are you sure you want to delete this donation? This action cannot be undone.</p>
      <div class="flex gap-3">
        <button
          (click)="cancelDelete()"
          class="flex-1 py-2.5 text-sm font-medium rounded-xl border border-gray-200 text-[#536471] hover:bg-gray-50 transition-colors"
        >
          Cancel
        </button>
        <button
          (click)="deleteDonation()"
          [disabled]="deleting"
          class="flex-1 py-2.5 text-sm font-bold rounded-xl transition-colors"
          [class.bg-[#ef4444]]="!deleting"
          [class.hover:bg-[#dc2626]]="!deleting"
          [class.text-white]="!deleting"
          [class.bg-gray-200]="deleting"
          [class.text-gray-400]="deleting"
          [class.cursor-not-allowed]="deleting"
        >
          {{ deleting ? 'Deleting...' : 'Delete' }}
        </button>
      </div>
    </div>
  </div>
}
