<div class="flex gap-6 p-8 h-full">
  <div class="flex-1 min-w-0">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold text-[#0f1419]">Donations Management</h1>
      <div class="relative">
        <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-[#9ca3af]" fill="none" viewBox="0 0 24 24"
          stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
        </svg>
        <input type="text" placeholder="Search donations..."
          class="pl-10 pr-4 py-2 w-[280px] bg-[#f7f9fa] border border-[#eef1f4] rounded-lg text-sm outline-none focus:border-[#38a9f3]" />
      </div>
    </div>

    <!-- Stats -->
    @if (!isLoading && !error) {
    <div class="grid grid-cols-4 gap-4 mb-6">
      @for (stat of stats; track stat.label) {
      <div class="bg-[#f0fdf9] rounded-xl p-4 border border-[#e6f9f0]">
        <p class="text-[11px] text-[#9ca3af] mb-1">{{ stat.label }}</p>
        <p class="text-2xl font-bold {{ stat.valueColor }}">{{ stat.value }}</p>
        <p class="text-[11px] {{ stat.subColor }} mt-1">{{ stat.sub }}</p>
      </div>
      }
    </div>
    }

    <!-- Donations Table -->
    <div class="bg-white rounded-2xl border border-[#eef1f4] p-6">
      <div class="flex items-center justify-between mb-4">
        <div class="flex gap-1 border-b border-[#eef1f4]">
          @for (tab of tabs; track tab) {
          <button (click)="activeTab = tab"
            class="px-4 py-2.5 text-sm font-medium transition-colors border-b-2 -mb-[1px]"
            [class.border-[#38a9f3]]="activeTab === tab" [class.text-[#0f1419]]="activeTab === tab"
            [class.border-transparent]="activeTab !== tab" [class.text-[#9ca3af]]="activeTab !== tab">{{ tab }}</button>
          }
        </div>
        <button (click)="openCreateModal()"
          class="flex items-center gap-1.5 px-4 py-2 text-sm font-semibold text-white bg-[#38a9f3] rounded-lg hover:bg-[#2196e3]">+
          Add Donation</button>
      </div>

      <!-- Loading -->
      @if (isLoading) {
      <div class="flex flex-col items-center justify-center py-16 gap-3">
        <div class="w-8 h-8 border-3 border-[#eff3f4] border-t-[#38a9f3] rounded-full animate-spin"></div>
        <span class="text-sm text-[#9ca3af]">Loading donations...</span>
      </div>
      }

      <!-- Error -->
      @if (!isLoading && error) {
      <div class="flex flex-col items-center justify-center py-16 gap-3">
        <p class="text-sm text-[#9ca3af]">{{ error }}</p>
        <button (click)="loadDonations()" class="text-sm font-semibold text-[#38a9f3] hover:underline">Try
          Again</button>
      </div>
      }

      <!-- Table -->
      @if (!isLoading && !error) {
      <table class="w-full">
        <thead>
          <tr class="bg-[#f0fdf9]">
            <th class="text-left text-[11px] font-semibold text-[#536471] uppercase px-4 py-2.5 rounded-l-lg">Donor</th>
            <th class="text-left text-[11px] font-semibold text-[#536471] uppercase px-4 py-2.5">Amount</th>
            <th class="text-left text-[11px] font-semibold text-[#536471] uppercase px-4 py-2.5">Payment</th>
            <th class="text-left text-[11px] font-semibold text-[#536471] uppercase px-4 py-2.5">Date</th>
            <th class="text-left text-[11px] font-semibold text-[#536471] uppercase px-4 py-2.5">Status</th>
            <th class="text-left text-[11px] font-semibold text-[#536471] uppercase px-4 py-2.5 rounded-r-lg"></th>
          </tr>
        </thead>
        <tbody>
          @for (donation of filteredDonations; track donation.id) {
          <tr class="border-t border-[#f7f9fa] cursor-pointer hover:bg-[#fafcfd]"
            [class.bg-[#f7f9ff]]="selectedDonation?.id === donation.id" (click)="selectDonation(donation)">
            <td class="px-4 py-3">
              <div class="flex items-center gap-2.5">
                <span class="text-lg">{{ donation.anonymous ? 'üï∂Ô∏è' : 'üë§' }}</span>
                <div>
                  <p class="text-sm font-medium text-[#0f1419]">{{ donation.anonymous ? 'Anonymous' : 'User #' +
                    (donation.userId || '‚Äî') }}</p>
                  <p class="text-[11px] text-[#9ca3af]">{{ donation.anonymous ? 'Hidden identity' : 'Registered user' }}
                  </p>
                </div>
              </div>
            </td>
            <td class="px-4 py-3 text-sm font-semibold text-[#0f1419]">{{ donation.amount }} TND</td>
            <td class="px-4 py-3 text-sm text-[#536471]">{{ donation.paymentMethod || '‚Äî' }}</td>
            <td class="px-4 py-3 text-sm text-[#536471]">{{ formatDate(donation.donatedAt) }}</td>
            <td class="px-4 py-3">
              <span class="text-[11px] font-semibold px-2.5 py-1 rounded-full {{ getStatusColor(donation.status) }}">{{
                donation.status }}</span>
            </td>
            <td class="px-4 py-3 text-[#9ca3af]">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
              </svg>
            </td>
          </tr>
          }
          @if (filteredDonations.length === 0) {
          <tr>
            <td colspan="6" class="px-4 py-12 text-center text-sm text-[#9ca3af]">No donations found.</td>
          </tr>
          }
        </tbody>
      </table>
      }
    </div>
  </div>

  <!-- Right Panel -->
  @if (selectedDonation) {
  <div class="w-[280px] shrink-0 bg-white rounded-2xl border border-[#eef1f4] p-6">
    <div class="text-center mb-5">
      <span class="text-4xl">{{ getStatusIcon(selectedDonation.status) }}</span>
      <p class="text-3xl font-bold text-[#0f1419] mt-2">{{ selectedDonation.amount }} TND</p>
      <span class="text-[11px] font-semibold px-2.5 py-1 rounded-full {{ getStatusColor(selectedDonation.status) }}">{{
        selectedDonation.status }}</span>
    </div>

    <div class="grid grid-cols-2 gap-3 mb-5">
      <div>
        <p class="text-[10px] font-semibold text-[#9ca3af] uppercase">Donor</p>
        <p class="text-sm font-medium text-[#0f1419]">{{ selectedDonation.anonymous ? 'Anonymous' : 'User #' +
          (selectedDonation.userId || '‚Äî') }}</p>
      </div>
      <div>
        <p class="text-[10px] font-semibold text-[#9ca3af] uppercase">Anonymous</p>
        <p class="text-sm font-medium" [class.text-green-500]="selectedDonation.anonymous"
          [class.text-[#0f1419]]="!selectedDonation.anonymous">
          {{ selectedDonation.anonymous ? 'Yes' : 'No' }}
        </p>
      </div>
      <div>
        <p class="text-[10px] font-semibold text-[#9ca3af] uppercase">Payment</p>
        <p class="text-sm font-medium text-[#0f1419]">{{ selectedDonation.paymentMethod || '‚Äî' }}</p>
      </div>
      <div>
        <p class="text-[10px] font-semibold text-[#9ca3af] uppercase">Date</p>
        <p class="text-sm font-medium text-[#0f1419]">{{ formatDate(selectedDonation.donatedAt) }}</p>
      </div>
      <div>
        <p class="text-[10px] font-semibold text-[#9ca3af] uppercase">ID</p>
        <p class="text-sm font-medium text-[#0f1419]">#{{ selectedDonation.id }}</p>
      </div>
    </div>

    @if (selectedDonation.message) {
    <div class="mb-5">
      <h4 class="text-[11px] font-semibold text-[#9ca3af] uppercase tracking-wide mb-2">Message</h4>
      <div class="bg-[#f7f9fa] rounded-xl p-3">
        <p class="text-xs text-[#536471] leading-relaxed italic">"{{ selectedDonation.message }}"</p>
      </div>
    </div>
    }

    <div class="flex gap-2 mt-4">
      <button (click)="openEditModal(selectedDonation)"
        class="flex-1 py-2.5 text-sm font-semibold text-white bg-[#38a9f3] rounded-xl hover:bg-[#2196e3]">Edit</button>
      <button (click)="confirmDelete()"
        class="py-2.5 px-3 text-sm font-semibold text-red-500 border border-red-200 rounded-xl hover:bg-red-50">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
        </svg>
      </button>
    </div>
  </div>
  }
</div>

<!-- Create/Edit Modal -->
@if (showModal) {
<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" (click)="closeModal()">
  <div class="bg-white rounded-2xl shadow-xl w-[520px] max-h-[85vh] overflow-y-auto" (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between p-6 border-b border-[#eef1f4]">
      <h2 class="text-lg font-bold text-[#0f1419]">{{ isEditing ? 'Edit Donation' : 'Add New Donation' }}</h2>
      <button (click)="closeModal()" class="text-[#9ca3af] hover:text-[#0f1419]">
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="p-6 space-y-5">
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-semibold text-[#536471] mb-1.5">Amount (TND) *</label>
          <input type="number" [(ngModel)]="formData.amount"
            class="w-full px-3 py-2 border rounded-lg text-sm outline-none"
            [class.border-red-400]="formSubmitted && formErrors['amount']"
            [class.focus:border-red-400]="formSubmitted && formErrors['amount']"
            [class.border-[#eef1f4]]="!formSubmitted || !formErrors['amount']"
            [class.focus:border-[#38a9f3]]="!formSubmitted || !formErrors['amount']"
            placeholder="0.00" />
          @if (formSubmitted && formErrors['amount']) {
            <p class="text-[11px] text-red-500 mt-1">{{ formErrors['amount'] }}</p>
          }
        </div>
        <div>
          <label class="block text-xs font-semibold text-[#536471] mb-1.5">Status *</label>
          <select [(ngModel)]="formData.status"
            class="w-full px-3 py-2 border rounded-lg text-sm outline-none bg-white"
            [class.border-red-400]="formSubmitted && formErrors['status']"
            [class.focus:border-red-400]="formSubmitted && formErrors['status']"
            [class.border-[#eef1f4]]="!formSubmitted || !formErrors['status']"
            [class.focus:border-[#38a9f3]]="!formSubmitted || !formErrors['status']">
            @for (s of donationStatuses; track s) {
            <option [value]="s">{{ s }}</option>
            }
          </select>
          @if (formSubmitted && formErrors['status']) {
            <p class="text-[11px] text-red-500 mt-1">{{ formErrors['status'] }}</p>
          }
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-semibold text-[#536471] mb-1.5">User ID</label>
          <input type="number" [(ngModel)]="formData.userId"
            class="w-full px-3 py-2 border rounded-lg text-sm outline-none"
            [class.border-red-400]="formSubmitted && formErrors['userId']"
            [class.focus:border-red-400]="formSubmitted && formErrors['userId']"
            [class.border-[#eef1f4]]="!formSubmitted || !formErrors['userId']"
            [class.focus:border-[#38a9f3]]="!formSubmitted || !formErrors['userId']"
            placeholder="Leave empty for anonymous" />
          @if (formSubmitted && formErrors['userId']) {
            <p class="text-[11px] text-red-500 mt-1">{{ formErrors['userId'] }}</p>
          }
        </div>
        <div>
          <label class="block text-xs font-semibold text-[#536471] mb-1.5">Payment Method *</label>
          <input type="text" [(ngModel)]="formData.paymentMethod"
            class="w-full px-3 py-2 border rounded-lg text-sm outline-none"
            [class.border-red-400]="formSubmitted && formErrors['paymentMethod']"
            [class.focus:border-red-400]="formSubmitted && formErrors['paymentMethod']"
            [class.border-[#eef1f4]]="!formSubmitted || !formErrors['paymentMethod']"
            [class.focus:border-[#38a9f3]]="!formSubmitted || !formErrors['paymentMethod']"
            placeholder="Card, PayPal, Bank..." />
          @if (formSubmitted && formErrors['paymentMethod']) {
            <p class="text-[11px] text-red-500 mt-1">{{ formErrors['paymentMethod'] }}</p>
          }
        </div>
      </div>

      <div>
        <label class="block text-xs font-semibold text-[#536471] mb-1.5">Donated At</label>
        <input type="datetime-local" [(ngModel)]="formData.donatedAt"
          class="w-full px-3 py-2 border border-[#eef1f4] rounded-lg text-sm outline-none focus:border-[#38a9f3]" />
      </div>

      <div>
        <label class="block text-xs font-semibold text-[#536471] mb-1.5">Message</label>
        <textarea [(ngModel)]="formData.message" rows="3"
          class="w-full px-3 py-2 border rounded-lg text-sm outline-none resize-none"
          [class.border-red-400]="formSubmitted && formErrors['message']"
          [class.focus:border-red-400]="formSubmitted && formErrors['message']"
          [class.border-[#eef1f4]]="!formSubmitted || !formErrors['message']"
          [class.focus:border-[#38a9f3]]="!formSubmitted || !formErrors['message']"
          placeholder="Optional message from the donor..."></textarea>
        @if (formSubmitted && formErrors['message']) {
          <p class="text-[11px] text-red-500 mt-1">{{ formErrors['message'] }}</p>
        }
      </div>

      <label class="flex items-center gap-2 text-sm text-[#0f1419] cursor-pointer">
        <input type="checkbox" [(ngModel)]="formData.anonymous"
          class="w-4 h-4 rounded border-[#eef1f4] text-[#38a9f3] focus:ring-[#38a9f3]" />
        Anonymous Donation
      </label>
    </div>

    <div class="flex items-center justify-end gap-3 px-6 py-4 border-t border-[#eef1f4]">
      <button (click)="closeModal()"
        class="px-5 py-2.5 text-sm font-semibold text-[#536471] border border-[#eef1f4] rounded-xl hover:bg-[#f7f9fa]">Cancel</button>
      <button (click)="saveDonation()" [disabled]="isSaving"
        class="px-5 py-2.5 text-sm font-semibold text-white bg-[#38a9f3] rounded-xl hover:bg-[#2196e3] disabled:opacity-50">
        {{ isSaving ? 'Saving...' : (isEditing ? 'Update' : 'Add Donation') }}
      </button>
    </div>
  </div>
</div>
}

<!-- Delete Confirmation -->
@if (showDeleteConfirm) {
<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" (click)="cancelDelete()">
  <div class="bg-white rounded-2xl shadow-xl w-[400px] p-6" (click)="$event.stopPropagation()">
    <div class="flex items-center gap-3 mb-4">
      <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center shrink-0">
        <svg class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
        </svg>
      </div>
      <div>
        <h3 class="text-[15px] font-bold text-[#0f1419]">Delete Donation</h3>
        <p class="text-xs text-[#9ca3af]">This action cannot be undone.</p>
      </div>
    </div>
    <p class="text-sm text-[#536471] mb-6">Are you sure you want to delete the donation of <strong>{{
        selectedDonation?.amount }} TND</strong>?</p>
    <div class="flex gap-3">
      <button (click)="cancelDelete()"
        class="flex-1 py-2.5 text-sm font-semibold text-[#536471] border border-[#eef1f4] rounded-xl hover:bg-[#f7f9fa]">Cancel</button>
      <button (click)="deleteDonation()" [disabled]="isDeleting"
        class="flex-1 py-2.5 text-sm font-semibold text-white bg-red-500 rounded-xl hover:bg-red-600 disabled:opacity-50">
        {{ isDeleting ? 'Deleting...' : 'Delete' }}
      </button>
    </div>
  </div>
</div>
}